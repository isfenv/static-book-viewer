
                <h2>رویدادهای لمسی (Touch Events)</h2>
                <div><p style="text-align: justify;">در سال‌های اخیر استفاده از دستگاه‌های مجهز به صفحه نمایش‌های لمسی (مانند تلفن همراه و تبلت) بسیار فراگیر شده است. با توجه به این که در این دستگاه‌ها معمولاً از ماوس استفاده نمی‌شود و بیشتر از لمس صفحه نمایش برای تعامل با دستگاه استفاده می‌شود، باید از رویدادهای دیگری به عنوان جایگزین رویدادهای ماوس استفاده کرد. البته رویدادهای click و dblclick را به خوبی می‌توان با لمس صفحه نمایش تولید کرد. اما سایر رویدادهای ماوس در صفحات لمسی یا قابل تولید نیستند (مانند mousemove) و یا عملکر مناسبی ندارند (مانند mousedown).</p>
<p>&nbsp;</p>
<h3>انواع رویدادهای لمسی</h3>
<p>در مجموع <span class="text-dark">۴</span> نوع رویداد لمسی در جاوا اسکریپت تعریف شده است که به شرح زیر می‌باشند.</p>
<ul>
<li style="text-align: justify;">touchstart : به محض لمس کردن صفحه نمایش رخ می‌دهد. این رویداد تقریباً معادل رویداد mousedown است.</li>
<li style="text-align: justify;">touchend : به محض برداشتن انگشت (یا قلم) از روی صفحه نمایش رخ می‌دهد. این رویداد تقریباً معادل رویداد mouseup است.</li>
<li style="text-align: justify;">touchmove : در زمان حرکت انگشت (یا قلم) بر روی صفحه نمایش رخ می‌دهد. این رویداد تقریبا معادل رویداد mousemove است.</li>
<li style="text-align: justify;">touchcancel : در صورتی که در زمان لمس صفحه نمایش وقفه‌ای رخ دهد، این رویداد تولید می‌شود. البته رفتار این رویداد در مرورگرها و دستگاه‌های مختلف تا حدودی متفاوت است. مثلاً در زمان خروج انگشت از صفحه نمایش ممکن است این رویداد رخ دهد. و یا در صورت لمس همزمان با چند انگشت و یا در صورت اجرای تابع alert برای نمایش یک پیام در زمان لمس صفحه ممکن است این رویداد رخ دهد.</li>
</ul>
<p style="text-align: justify;">برای درک بهتر عملکرد هر یک از رویداهای فوق مثال زیر را اجرا کنید. در این مثال یک عنصر از نوع &lt;div&gt; وجود دارد که در صورت وقوع هر یک از رویدادهای لمسی در محدوده‌ی این عنصر، تابع handler فراخوانی شده و نام رویداد رخ داده را در عنصری دیگر از نوع &lt;p&gt; نمایش می‌دهد. توجه کنید که این مثال را حتماً باید در دستگاهی که مجهز به صفحه نمایش لمسی است اجرا کنید. و یا از شبیه‌ساز مرورگر Chrome استفاده کنید. این مثال را می‌توانید <a href="https://codepen.io/abbassac/pen/gQzEmY" target="_blank" rel="noopener noreferrer">اینجا</a> در CodePen اجرا کنید.</p>
<pre class="ltr"><code class="language-javascript">
const div = document.querySelector('div');
div.addEventListener('touchstart', handler);
div.addEventListener('touchmove', handler);            
div.addEventListener('touchend', handler);
div.addEventListener('touchcancel', handler);
function handler(event) {
	const p = document.querySelector('p');
	p.textContent += event.type + ' ';
}
</code></pre>
<p style="text-align: justify;"><span style="color: #ff0000;"><strong>نکته :</strong> </span>در دستگاه‌های مجهز به صفحه نمایش لمسی، معمولاً برای شبیه‌سازی دکمه‌ی فرعی ماوس (یا کلیک راست) باید صفحه را لمس کرده و حدود ۲ ثانیه انگشت (یا قلم) را ثابت نگاه داشت. لذا انجام این کار موجب تولید رویداد contextmenu در این نوع دستگاه‌ها می‌شود.</p>
<p>&nbsp;</p>
<h3>خاصیت‌های شئ event</h3>
<p style="text-align: justify;">پیش از این دیدیم که در رویدادهای ماوس، شئ event دارای خاصیت‌هایی برای دسترسی به مختصات محل وقوع رویداد است. اما در رویدادهای لمسی امکان استفاده از این خاصیت‌ها وجود ندارد. با توجه به این که در صفحه نمایش‌های لمسی، امکان انجام چند لمس به صورت همزمان وجود دارد، در نتیجه به تعداد لمس‌های انجام شده، مختصات وجود خواهد داشت. به همین دلیل خاصیت‌هایی که در رویدادهای ماوس برای به دست آوردن مختصات استفاده می‌شوند، در رویدادهای لمسی قابل استفاده نیستند. اما سایر خاصیت‌های شئ event که در رویدادهای ماوس وجود دارند، در رویدادهای لمسی نیز قابل استفاده‌اند.</p>
<p style="text-align: justify;">برای ادامه‌ی بحث و معرفی روش دستیابی به مختصات نقاط لمس شده، ابتدا باید به معرفی شئ Touch بپردازیم. در جاوا اسکریپت برای مشخص کردن مختصات و سایر مشخصات یک نقطه‌ی لمس شده از صفحه نمایش، از شئ Touch استفاده می‌شود. این شئ دارای تعدادی خاصیت به شرح زیر است که تقریباً در تمام دستگاه‌های لمسی پشتیبانی می‌شوند.</p>
<ul>
<li>clientX و clientY : مختصات محل لمس نسبت به گوشه‌ی بالا و چپ مرورگر (فقط بخش نمایشی یا Viewport مرورگر).</li>
<li>pageX و pageY : مختصات محل لمس نسبت به گوشه‌ی بالا و چپ صفحه‌ی وب.</li>
<li>screenX و screenY : مختصات لمس رویداد نسبت به گوشه‌ی بالا و چپ صفحه نمایش.</li>
<li>identifier : شماره‌ی نقطه‌ی لمس شده. (هر یک از نقاط لمس شده یک شناسه‌ی عددی دارند)</li>
<li>target : عنصری که رویداد لمس از آنجا شروع شده. (حتی با خارج شدن از عنصر شروع کننده، مقدار خاصیت target عوض نمی‌شود)</li>
</ul>
<p style="text-align: justify;">اما شئ Touch دارای <span class="text-dark">۴</span> خاصیت دیگر نیز می‌باشد که فعلاً به استاندارد نهایی اضافه نشده‌اند و پشتیبانی از آنها در دستگاه‌های مختلف متفاوت است. این خاصیت‌ها برای به دست آوردن اطلاعاتی در مورد نحوه‌ی لمس صفحه به کار می‌روند. اسامی این <span class="text-dark">۴</span> خاصیت و کاربرد هر یک در زیر آمده است. توجه کنید که منظور از &#8220;بیضی&#8221; در توضیحات زیر، همان سطح تماس انگشت با صفحه نمایش است که معمولاً به شکل بیضی می‌باشد.</p>
<ul>
<li>radiusX : شعاع بیضی روی محور X.</li>
<li>radiusY : شعاع بیضی روی محور Y.</li>
<li style="text-align: justify;">rotationAngle : میزان دوران بیضی بر حسب درجه. یعنی بیضی اولیه که با radiusX و radiusY تعریف می‌شود، باید به این میزان در جهت ساعتگرد دوران کند تا منطبق با سطح لمس شده با انگشت باشد.</li>
<li style="text-align: justify;">force : میزان فشار وارد شده بر محل لمس که عددی بین صفر و یک است.</li>
</ul>
<p style="text-align: justify;">البته تعاریف فوق، تعاریف استانداردی است که برای این خاصیت‌ها ارائه شده است. اما در حال حاضر در دستگاه‌های مختلف رفتار این خاصیت‌ها متفاوت است. (مثلاً در آزمایشی که بر روی تلفن همراه من با مرورگر Chrome انجام شد، به غیر از خاصیت force، بقیه موارد برابر با صفر بودند. ضمناً خاصیت force میزان فشار را نشان نمی‌دهد، بلکه با بیشتر شدن سطح لمس شده، بزرگتر می‌شود.)</p>
<p style="text-align: justify;">اما برای استفاده از خاصیت‌های شئ Touch به خاصیت‌هایی از شئ event نیاز خواهیم داشت. شئ event در رویدادهای لمسی دارای <span class="text-dark">۳</span> خاصیت به نام‌های touches و changedTouches و targetTouches می‌باشد. هر یک از این خاصیت‌ها حاوی لیستی از اشیاء Touch هستند. یعنی مانند یک آرایه رفتار می‌کنند. محتوای هر یک از این خاصیت‌ها به شرح زیر است.</p>
<ul>
<li>touches : شامل لیستی از تمام نقاط لمس شده در صفحه نمایش</li>
<li>targetTouches : شامل لیستی از تمام نقاط لمس شده در صفحه نمایش که نقطه‌ی شروع آنها در شئ target بوده است. (شئ target همان عنصری است که Event Handler آن فراخوانی شده و در حال اجرا است)</li>
<li>changedTouches : لیستی از نقاط لمس شده که وضعیتشان نسبت به قبل تغییر کرده است.</li>
</ul>
<p style="text-align: justify;">خاصیت touches بیشترین کاربرد را در بین موارد فوق دارد. مثال زیر را بر روی تلفن همراه یا تبلت اجرا کنید تا با رفتار این خاصیت و خاصیت‌های شئ Touch بهتر آشنا شوید. در این مثال فرض شده است که فقط یک نقطه لمس شده است. این مثال را می‌توانید <a href="https://codepen.io/abbassac/pen/NEzPNv" target="_blank" rel="noopener noreferrer">اینجا</a> اجرا کنید.</p>
<pre class="ltr"><code class="language-javascript">
const div = document.querySelector('div');
div.addEventListener('touchstart', handler);
function handler(event) {
	const p = document.querySelector('p');
	p.innerHTML = 'clientX: ' + event.touches[0].clientX +'&lt;br /&gt;';
	p.innerHTML += 'clientY: ' + event.touches[0].clientY + '&lt;br /&gt;';
	p.innerHTML += 'screenX: ' + event.touches[0].screenX + '&lt;br /&gt;';
	p.innerHTML += 'screenY: ' + event.touches[0].screenY + '&lt;br /&gt;';
	p.innerHTML += 'pageX: ' + event.touches[0].pageX + '&lt;br /&gt;';
	p.innerHTML += 'pageY: ' + event.touches[0].pageY + '&lt;br /&gt;';
	p.innerHTML += 'identifier: ' + event.touches[0].identifier + '&lt;br /&gt;';
	p.innerHTML += 'target: ' + event.touches[0].target.tagName;
}
</code></pre>
<p style="text-align: justify;"><span style="color: #ff0000;"><strong>نکته :</strong></span> در دستگاه‌های مجهز به صفحه نمایش‌های لمسی، مقدار خاصیت‌های مربوط به مختصات معمولاً اعشاری هستند.</p>
<p style="text-align: justify;">جهت مشاهده‌ی رفتار سایر خاصیت‌های شئ Touch که پشتیبانی کمتری در دستگاه‌های مختلف دارند، از مثال زیر استفاده کنید. در این مثال نیز فرض شده است که فقط یک نقطه لمس می‌شود. این مثال را می‌توانید <a href="https://codepen.io/abbassac/pen/zMaYLa" target="_blank" rel="noopener noreferrer">اینجا</a> اجرا کنید.</p>
<pre class="ltr"><code class="language-javascript">
const div = document.querySelector('div');
div.addEventListener('touchstart', handler);
function handler(event) {
	const p = document.querySelector('p');
	p.innerHTML = 'RadiusX: ' + event.touches[0].radiusX + '&lt;br /&gt;';
	p.innerHTML += 'RadiusY: ' + event.touches[0].radiusY + '&lt;br /&gt;';
	p.innerHTML += 'angle: ' + event.touches[0].rotationAngle + '&lt;br /&gt;';
	p.innerHTML += 'force: ' + event.touches[0].force;
}
</code></pre>
<p style="text-align: justify;">حال برای مشاهده‌ی رفتار خاصیت touches در صورت لمس شدن همزمان چند نقطه از صفحه نمایش، مثال زیر را اجرا کنید. در این مثال مختصات تمام نقاط لمس شده در صفحه‌ی وب در یک عنصر از نوع &lt;p&gt; نمایش داده می‌شود. این مثال را می‌توانید <a href="https://codepen.io/abbassac/pen/dQKPKM" target="_blank" rel="noopener noreferrer">اینجا</a> اجرا کنید.</p>
<pre class="ltr"><code class="language-javascript">
document.addEventListener('touchstart', handler);
function handler(event) {
	const p = document.querySelector('p');
	const points = event.touches.length;
	let message = '';
	for(let i=0 ; i &lt; points ; i++){
		message += `Point ${i}: &lt;br /&gt;
			clientX: ${event.touches[i].clientX}&lt;br /&gt;
			clientY: ${event.touches[i].clientY}&lt;br /&gt;&lt;br /&gt;`;
	}
	p.innerHTML = message;
}
</code></pre>
<p style="text-align: justify;">شکل زیر نمونه‌ای از اجرای این برنامه را نشان می‌دهد. حالت نشان داده شده در این شکل با لمس همزمان <span class="text-dark">۴</span> نقطه از صفحه نمایش به وجود آمده است. مشاهده می‌کنید که اعداد مربوط به مختصات، اعشاری هستند.</p>
<p style="text-align: center;"><img class="alignnone wp-image-715 size-full" src="https://otedia.com/wp-content/uploads/2018/11/multi-touch.png" alt="multi-touch" width="360" srcset="https://otedia.com/wp-content/uploads/2018/11/multi-touch.png 540w, https://otedia.com/wp-content/uploads/2018/11/multi-touch-196x300.png 196w" sizes="(max-width: 540px) 100vw, 540px" /></p>
<p style="text-align: justify;">در نهایت ذکر این نکته ضروری است که استفاده از رویدادهای لمسی کمی دشوار است و برای استفاده از این رویدادها باید با دقت بالا کدنویسی کرده و حتماً برنامه را در چند دستگاه محتلف آزمایش کنید.</p>
</div>
                